<!doctype html>

<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Esegui JS - Playground</title>
  <style>
    :root{font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{margin:0;display:flex;flex-direction:column;height:100vh}
    header{padding:12px 16px;background:#0f172a;color:#fff;display:flex;gap:12px;align-items:center}
    main{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px;flex:1}
    textarea{width:100%;height:100%;resize:none;padding:12px;font-family:monospace;font-size:14px;border-radius:8px;border:1px solid #e2e8f0}
    .controls{display:flex;gap:8px}
    button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    button.run{background:#06b6d4;color:#04203a}
    button.clear{background:#f3f4f6}
    .panel{display:flex;flex-direction:column}
    iframe{width:100%;height:100%;border:1px solid #e2e8f0;border-radius:8px;background:white}
    footer{padding:8px 12px;font-size:13px;background:#f8fafc;border-top:1px solid #e2e8f0}
    .hint{opacity:0.85;font-size:13px}
  </style>
</head>
<body>
  <header>
    <strong>Esegui JS — playground</strong>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <span class="hint">Scrivi `alert('ciao')` e premi Run → vedrai l'alert nel riquadro a destra</span>
    </div>
  </header>  <main>
    <div class="panel">
      <label style="font-weight:600;margin-bottom:6px">Editor JavaScript</label>
      <textarea id="editor">// Esempio: alert('Ciao dal browser!')
</textarea>
      <div style="margin-top:8px" class="controls">
        <button class="run" id="runBtn">Run</button>
        <button class="clear" id="clearBtn">Clear</button>
        <button id="sampleBtn">Inserisci esempio</button>
        <button id="newtabBtn">Apri in nuova scheda</button>
      </div>
    </div><div class="panel">
  <label style="font-weight:600;margin-bottom:6px">Output (iframe con sandbox)</label>
  <!-- sandbox: allow-scripts per eseguire solo JS dentro l'iframe -->
  <iframe id="output" sandbox="allow-scripts"></iframe>
</div>

  </main>  <footer>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="hint">Attenzione: questo esegue codice JS localmente. Non eseguire codice non fidato.</div>
      <div class="hint">Salva il file come <code>.html</code> e aprilo nel browser.</div>
    </div>
  </footer><script>
  const editor = document.getElementById('editor');
  const runBtn = document.getElementById('runBtn');
  const clearBtn = document.getElementById('clearBtn');
  const sampleBtn = document.getElementById('sampleBtn');
  const output = document.getElementById('output');
  const newtabBtn = document.getElementById('newtabBtn');

  // Funzione che costruisce un documento HTML con lo script inserito
  function buildSrcDoc(code){
    // Evitiamo che la stringa contenga </script> che chiuderebbe il tag script in modo non intenzionaleconst safeCode = code.replace(/<\\/g, '<\\\').replace(/<\/script>/gi, '<\\/script>');

return `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body>
  <script>
    try{\n${safeCode}\n}catch(e){\n  // mostra l'errore nella console dell'iframe

console.error('Errore eseguendo il codice:', e); } </script> </body></html>`; }

function runCode(){ const code = editor.value; output.srcdoc = buildSrcDoc(code); }

runBtn.addEventListener('click', runCode); clearBtn.addEventListener('click', ()=>{ editor.value = ''; output.srcdoc = '<!doctype html><html><body></body></html>'; }); sampleBtn.addEventListener('click', ()=>{ editor.value = "alert('Ciao dal playground!');"; });

newtabBtn.addEventListener('click', ()=>{ const win = window.open(); if(!win) return alert('Impossibile aprire una nuova finestra (popup bloccato).'); win.document.open(); win.document.write(buildSrcDoc(editor.value)); win.document.close(); });

// inizializza iframe vuoto output.srcdoc = '<!doctype html><html><body></body></html>'; </script>

</body>
    </html>
